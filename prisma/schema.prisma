// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model
model User {
  id                    Int       @id @default(autoincrement())
  firstName             String
  middleName            String?
  lastName              String?
  email                 String    @unique
  password              String    // Hashed with bcrypt
  accessTokenExpiration DateTime?

  // Relations
  posts                 Post[]

  // Timestamps (stored in UTC)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([email])
}

// Post model
// NOTE: All dates are stored in UTC+0, application handles conversion to Philippine Time (UTC+8)
model Post {
  id              Int       @id @default(autoincrement())
  userId          Int
  type            PostType
  typeCount       Int       @default(1)  // Number of files
  caption         String    @db.Text
  publishDateTime DateTime  // Combined date and time stored in UTC
  isPublished     Boolean   @default(false)
  isVideo         Boolean   @default(false)

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  files           PostFile[]

  // Timestamps (stored in UTC)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([userId])
  @@index([publishDateTime, isPublished])
  @@index([isPublished])
}

// PostFile model
model PostFile {
  id       Int      @id @default(autoincrement())
  postId   Int
  url      String   @db.Text
  caption  String   @db.Text

  // Relations
  post     Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  // Timestamp (stored in UTC)
  createdAt DateTime @default(now())

  @@index([postId])
}

// Post type enum
enum PostType {
  SINGLE_IMAGE
  SINGLE_VIDEO
  MULTIPLE_IMAGES
  MULTIPLE_VIDEOS
  MIXED_MEDIA
}
